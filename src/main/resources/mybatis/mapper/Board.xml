<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.board">
    <select id="boardList" parameterType="map" resultType="Board">
        SELECT
            BO.BOARD_SEQ
             , BO.BOARD_TYPE
             , BO.BOARD_TITLE
             , BO.BOARD_CONTENT
             , BO.BOARD_SECRET_YN
             , BO.BOARD_DEL_YN
             , BO.REPLY_YN
             , BO.REPLY_CONTENT
             , BO.REPLY_MEMBER_ID
             , BO.REPLY_DT
             , BO.ATTCH_FILE_CNT
             , COALESCE(BO.INQ_CNT, 0) AS INQ_CNT
             , BO.REG_ID
             , BO.REG_NM
             , BO.REG_DT
             , BO.UPD_ID
             , BO.UPD_NM
             , BO.UPD_DT
             , M.MENU_SEQ
             , M.MENU_NAME
             , M.MENU_BOARD_TYPE AS boardType
        FROM BOARD BO
                 LEFT JOIN MENU M on M.MENU_BOARD_TYPE = BO.BOARD_TYPE
        WHERE BO.BOARD_DEL_YN = 'N'
          AND MENU_USE_YN = 'Y'
          AND BO.BOARD_TYPE = #{boardType}
        ORDER BY BO.BOARD_SEQ DESC
            LIMIT 5
    </select>
    <insert id="writeBoard" parameterType="Board">
        INSERT INTO BOARD
        (BOARD_TITLE
        , BOARD_CONTENT
        , BOARD_SECRET_YN
        , BOARD_TYPE
        , BOARD_DEL_YN
        , PASSWORD
        , REG_NM
        , REG_ID
        , REG_DT
        )
        VALUES
            ( #{boardTitle}
            , #{boardContent}
            , #{boardSecretYn}
            , #{boardType}
            , 'N'
            , #{password}
            , #{regNm}
            , #{regNm}
            , NOW()
            )
    </insert>
    <select id="boardDetail" parameterType="Board" resultType="Board">
        SELECT
            BOARD_SEQ
             , BOARD_TYPE
             , BOARD_TITLE
             , BOARD_CONTENT
             , BOARD_SECRET_YN
             , BOARD_DEL_YN
             , REPLY_YN
             , REPLY_CONTENT
             , REPLY_MEMBER_ID
             , REPLY_DT
             , ATTCH_FILE_CNT
             , INQ_CNT
             , REG_ID
             , REG_NM
             , REG_DT
             , UPD_ID
             , UPD_NM
             , UPD_DT
             , PASSWORD
        FROM BOARD
        WHERE BOARD_SEQ = #{boardSeq}
    </select>
    <update id="updateInqCnt" parameterType="BOARD">
        UPDATE BOARD
        SET INQ_CNT = COALESCE(INQ_CNT, 0) + 1
        WHERE BOARD_SEQ = #{boardSeq}
    </update>

    <select id="getTotalBoardCount" parameterType="String" resultType="int">
        SELECT COUNT(*) FROM board
        WHERE BOARD_DEL_YN = 'N'
        AND BOARD_TYPE = #{boardType}
    </select>

    <select id="selectPassword" parameterType="Board" resultType="Board">
        SELECT
            BOARD_SEQ
             , PASSWORD
             , REG_ID
        FROM BOARD
        WHERE BOARD_SEQ = #{boardSeq}
    </select>

    <update id="updateBoard" parameterType="Board">
        UPDATE BOARD
        SET
            BOARD_TITLE = #{boardTitle}
          , BOARD_CONTENT = #{boardContent}
          , BOARD_SECRET_YN = #{boardSecretYn}
          , BOARD_TYPE = #{boardType}
          , BOARD_DEL_YN = 'N'
          , password = #{password}
          , UPD_NM = #{updNm}
          , UPD_ID = #{updNm}
          , UPD_DT = NOW()
        WHERE BOARD_SEQ = #{boardSeq}
    </update>

    <update id="deleteBoard" parameterType="Board">
        UPDATE BOARD
        SET
            BOARD_DEL_YN = 'Y'
        WHERE BOARD_SEQ = #{boardSeq}
    </update>

    <select id="getMenuList"  resultType="Board">
        SELECT
               MENU_SEQ
             , MENU_NAME
             , MENU_URL
             , MENU_SITE
             , MENU_BOARD_TYPE
        FROM MENU
        WHERE MENU_SITE = 'U'
        AND MENU_USE_YN = 'Y'
        ORDER BY MENU_ORDER DESC
    </select>

    <select id="boardTypeList"  resultType="Board">
        SELECT
            M.MENU_BOARD_TYPE AS BOARDTYPE
             , M.MENU_NAME
        FROM  MENU M
        LEFT JOIN BOARD BO ON M.MENU_BOARD_TYPE = BO.BOARD_TYPE
        WHERE M.MENU_USE_YN = 'Y'
          AND M.MENU_SITE  = 'U'
        GROUP BY M.MENU_BOARD_TYPE
    </select>

    <select id="boardDetailList" parameterType="map" resultType="Board">
        SELECT
            BO.BOARD_SEQ
             , BO.BOARD_TYPE
             , BO.BOARD_TITLE
             , BO.BOARD_CONTENT
             , BO.BOARD_SECRET_YN
             , BO.BOARD_DEL_YN
             , BO.REPLY_YN
             , BO.REPLY_CONTENT
             , BO.REPLY_MEMBER_ID
             , BO.REPLY_DT
             , BO.ATTCH_FILE_CNT
             , COALESCE(BO.INQ_CNT, 0) AS INQ_CNT
             , BO.REG_ID
             , BO.REG_NM
             , BO.REG_DT
             , BO.UPD_ID
             , BO.UPD_NM
             , BO.UPD_DT
             , M.MENU_SEQ
             , M.MENU_NAME
        FROM BOARD BO
                 INNER JOIN MENU M on M.MENU_SEQ = BO.BOARD_TYPE
        WHERE BO.BOARD_DEL_YN = 'N'
          AND BO.BOARD_TYPE = #{boardType}
        <if test="searchBoardTitle !=null and searchBoardTitle !=''">
            AND BO.BOARD_TITLE LIKE CONCAT('%',#{searchBoardTitle},'%')
        </if>
        ORDER BY BO.BOARD_SEQ DESC
            LIMIT #{startIdx}, #{countPerPage}
    </select>

    <select id="bannerList"  resultType="Banner">
        SELECT
            BANNER_SEQ
             , BANNER_URL
             , BN.FILE_IDX
             , REG_ID
             , BN.REG_DT
             , FT.ori_nm
             , FT.save_nm
             , FT.FILE_PATH
        FROM BANNER BN
        JOIN FILE FT ON BN.FILE_IDX = FT.FILE_IDX
        ORDER BY BANNER_ORDER ASC
    </select>
    <select id="selectName"  resultType="Board">
        SELECT M.MENU_NAME
         FROM MENU M
        WHERE  M.MENU_BOARD_TYPE = #{boardType}
    </select>

    <update id="updateFile" parameterType="FileDto">
        UPDATE FILE
        SET
            ORI_NM = #{oriNm}
          , SAVE_NM = #{saveNm}
          , FILE_PATH = #{filePath}
          , REG_DT = NOW()
        WHERE FILE_IDX = #{fileIdx}
    </update>

    <update id="updateBanner" parameterType="Banner">
        UPDATE BOARD
        SET
            BANNER_NAME = #{bannerName}
          , BANNER_PARENT_SEQ = #{bannerParentSeq}
          , BANNER_LEVEL = #{bannerLevel}
          , BANNER_ORDER = #{bannerOrder}
          , BANNER_USE_YN = #{bannerUseYn}
          , BANNER_TYPE = #{bannerType}
          , BANNER_URL = #{bannerUrl}
          , BANNER_CONN_WAY = #{bannerConnWay}
          , BANNER_DESC = #{bannerDesc}
          , UPD_DT = NOW()
        WHERE BANNER_SEQ = #{bannerSeq}
    </update>




</mapper>
